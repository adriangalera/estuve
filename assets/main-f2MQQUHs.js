import{r as $t,T as zt,L as vt,a as qt,i as Ht,w as Jt,_ as Vt,b as G}from"./maps-C6izXzfY.js";var F={exports:{}},Yt=F.exports,st;function Xt(){return st||(st=1,function(o,i){(function(r,l){l(i)})(Yt,function(r){var l=L.MarkerClusterGroup=L.FeatureGroup.extend({options:{maxClusterRadius:80,iconCreateFunction:null,clusterPane:L.Marker.prototype.options.pane,spiderfyOnEveryZoom:!1,spiderfyOnMaxZoom:!0,showCoverageOnHover:!0,zoomToBoundsOnClick:!0,singleMarkerMode:!1,disableClusteringAtZoom:null,removeOutsideVisibleBounds:!0,animate:!0,animateAddingMarkers:!1,spiderfyShapePositions:null,spiderfyDistanceMultiplier:1,spiderLegPolylineOptions:{weight:1.5,color:"#222",opacity:.5},chunkedLoading:!1,chunkInterval:200,chunkDelay:50,chunkProgress:null,polygonOptions:{}},initialize:function(t){L.Util.setOptions(this,t),this.options.iconCreateFunction||(this.options.iconCreateFunction=this._defaultIconCreateFunction),this._featureGroup=L.featureGroup(),this._featureGroup.addEventParent(this),this._nonPointGroup=L.featureGroup(),this._nonPointGroup.addEventParent(this),this._inZoomAnimation=0,this._needsClustering=[],this._needsRemoving=[],this._currentShownBounds=null,this._queue=[],this._childMarkerEventHandlers={dragstart:this._childMarkerDragStart,move:this._childMarkerMoved,dragend:this._childMarkerDragEnd};var e=L.DomUtil.TRANSITION&&this.options.animate;L.extend(this,e?this._withAnimation:this._noAnimation),this._markerCluster=e?L.MarkerCluster:L.MarkerClusterNonAnimated},addLayer:function(t){if(t instanceof L.LayerGroup)return this.addLayers([t]);if(!t.getLatLng)return this._nonPointGroup.addLayer(t),this.fire("layeradd",{layer:t}),this;if(!this._map)return this._needsClustering.push(t),this.fire("layeradd",{layer:t}),this;if(this.hasLayer(t))return this;this._unspiderfy&&this._unspiderfy(),this._addLayer(t,this._maxZoom),this.fire("layeradd",{layer:t}),this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons();var e=t,n=this._zoom;if(t.__parent)for(;e.__parent._zoom>=n;)e=e.__parent;return this._currentShownBounds.contains(e.getLatLng())&&(this.options.animateAddingMarkers?this._animationAddLayer(t,e):this._animationAddLayerNonAnimated(t,e)),this},removeLayer:function(t){return t instanceof L.LayerGroup?this.removeLayers([t]):t.getLatLng?this._map?t.__parent?(this._unspiderfy&&(this._unspiderfy(),this._unspiderfyLayer(t)),this._removeLayer(t,!0),this.fire("layerremove",{layer:t}),this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons(),t.off(this._childMarkerEventHandlers,this),this._featureGroup.hasLayer(t)&&(this._featureGroup.removeLayer(t),t.clusterShow&&t.clusterShow()),this):this:(!this._arraySplice(this._needsClustering,t)&&this.hasLayer(t)&&this._needsRemoving.push({layer:t,latlng:t._latlng}),this.fire("layerremove",{layer:t}),this):(this._nonPointGroup.removeLayer(t),this.fire("layerremove",{layer:t}),this)},addLayers:function(t,e){if(!L.Util.isArray(t))return this.addLayer(t);var n=this._featureGroup,s=this._nonPointGroup,a=this.options.chunkedLoading,d=this.options.chunkInterval,u=this.options.chunkProgress,c=t.length,f=0,p=!0,_;if(this._map){var y=new Date().getTime(),m=L.bind(function(){var v=new Date().getTime();for(this._map&&this._unspiderfy&&this._unspiderfy();f<c;f++){if(a&&f%200===0){var w=new Date().getTime()-v;if(w>d)break}if(_=t[f],_ instanceof L.LayerGroup){p&&(t=t.slice(),p=!1),this._extractNonGroupLayers(_,t),c=t.length;continue}if(!_.getLatLng){s.addLayer(_),e||this.fire("layeradd",{layer:_});continue}if(!this.hasLayer(_)&&(this._addLayer(_,this._maxZoom),e||this.fire("layeradd",{layer:_}),_.__parent&&_.__parent.getChildCount()===2)){var S=_.__parent.getAllChildMarkers(),b=S[0]===_?S[1]:S[0];n.removeLayer(b)}}u&&u(f,c,new Date().getTime()-y),f===c?(this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons(),this._topClusterLevel._recursivelyAddChildrenToMap(null,this._zoom,this._currentShownBounds)):setTimeout(m,this.options.chunkDelay)},this);m()}else for(var g=this._needsClustering;f<c;f++){if(_=t[f],_ instanceof L.LayerGroup){p&&(t=t.slice(),p=!1),this._extractNonGroupLayers(_,t),c=t.length;continue}if(!_.getLatLng){s.addLayer(_);continue}this.hasLayer(_)||g.push(_)}return this},removeLayers:function(t){var e,n,s=t.length,a=this._featureGroup,d=this._nonPointGroup,u=!0;if(!this._map){for(e=0;e<s;e++){if(n=t[e],n instanceof L.LayerGroup){u&&(t=t.slice(),u=!1),this._extractNonGroupLayers(n,t),s=t.length;continue}this._arraySplice(this._needsClustering,n),d.removeLayer(n),this.hasLayer(n)&&this._needsRemoving.push({layer:n,latlng:n._latlng}),this.fire("layerremove",{layer:n})}return this}if(this._unspiderfy){this._unspiderfy();var c=t.slice(),f=s;for(e=0;e<f;e++){if(n=c[e],n instanceof L.LayerGroup){this._extractNonGroupLayers(n,c),f=c.length;continue}this._unspiderfyLayer(n)}}for(e=0;e<s;e++){if(n=t[e],n instanceof L.LayerGroup){u&&(t=t.slice(),u=!1),this._extractNonGroupLayers(n,t),s=t.length;continue}if(!n.__parent){d.removeLayer(n),this.fire("layerremove",{layer:n});continue}this._removeLayer(n,!0,!0),this.fire("layerremove",{layer:n}),a.hasLayer(n)&&(a.removeLayer(n),n.clusterShow&&n.clusterShow())}return this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons(),this._topClusterLevel._recursivelyAddChildrenToMap(null,this._zoom,this._currentShownBounds),this},clearLayers:function(){return this._map||(this._needsClustering=[],this._needsRemoving=[],delete this._gridClusters,delete this._gridUnclustered),this._noanimationUnspiderfy&&this._noanimationUnspiderfy(),this._featureGroup.clearLayers(),this._nonPointGroup.clearLayers(),this.eachLayer(function(t){t.off(this._childMarkerEventHandlers,this),delete t.__parent},this),this._map&&this._generateInitialClusters(),this},getBounds:function(){var t=new L.LatLngBounds;this._topClusterLevel&&t.extend(this._topClusterLevel._bounds);for(var e=this._needsClustering.length-1;e>=0;e--)t.extend(this._needsClustering[e].getLatLng());return t.extend(this._nonPointGroup.getBounds()),t},eachLayer:function(t,e){var n=this._needsClustering.slice(),s=this._needsRemoving,a,d,u;for(this._topClusterLevel&&this._topClusterLevel.getAllChildMarkers(n),d=n.length-1;d>=0;d--){for(a=!0,u=s.length-1;u>=0;u--)if(s[u].layer===n[d]){a=!1;break}a&&t.call(e,n[d])}this._nonPointGroup.eachLayer(t,e)},getLayers:function(){var t=[];return this.eachLayer(function(e){t.push(e)}),t},getLayer:function(t){var e=null;return t=parseInt(t,10),this.eachLayer(function(n){L.stamp(n)===t&&(e=n)}),e},hasLayer:function(t){if(!t)return!1;var e,n=this._needsClustering;for(e=n.length-1;e>=0;e--)if(n[e]===t)return!0;for(n=this._needsRemoving,e=n.length-1;e>=0;e--)if(n[e].layer===t)return!1;return!!(t.__parent&&t.__parent._group===this)||this._nonPointGroup.hasLayer(t)},zoomToShowLayer:function(t,e){var n=this._map;typeof e!="function"&&(e=function(){});var s=function(){(n.hasLayer(t)||n.hasLayer(t.__parent))&&!this._inZoomAnimation&&(this._map.off("moveend",s,this),this.off("animationend",s,this),n.hasLayer(t)?e():t.__parent._icon&&(this.once("spiderfied",e,this),t.__parent.spiderfy()))};t._icon&&this._map.getBounds().contains(t.getLatLng())?e():t.__parent._zoom<Math.round(this._map._zoom)?(this._map.on("moveend",s,this),this._map.panTo(t.getLatLng())):(this._map.on("moveend",s,this),this.on("animationend",s,this),t.__parent.zoomToBounds())},onAdd:function(t){this._map=t;var e,n,s;if(!isFinite(this._map.getMaxZoom()))throw"Map has no maxZoom specified";for(this._featureGroup.addTo(t),this._nonPointGroup.addTo(t),this._gridClusters||this._generateInitialClusters(),this._maxLat=t.options.crs.projection.MAX_LATITUDE,e=0,n=this._needsRemoving.length;e<n;e++)s=this._needsRemoving[e],s.newlatlng=s.layer._latlng,s.layer._latlng=s.latlng;for(e=0,n=this._needsRemoving.length;e<n;e++)s=this._needsRemoving[e],this._removeLayer(s.layer,!0),s.layer._latlng=s.newlatlng;this._needsRemoving=[],this._zoom=Math.round(this._map._zoom),this._currentShownBounds=this._getExpandedVisibleBounds(),this._map.on("zoomend",this._zoomEnd,this),this._map.on("moveend",this._moveEnd,this),this._spiderfierOnAdd&&this._spiderfierOnAdd(),this._bindEvents(),n=this._needsClustering,this._needsClustering=[],this.addLayers(n,!0)},onRemove:function(t){t.off("zoomend",this._zoomEnd,this),t.off("moveend",this._moveEnd,this),this._unbindEvents(),this._map._mapPane.className=this._map._mapPane.className.replace(" leaflet-cluster-anim",""),this._spiderfierOnRemove&&this._spiderfierOnRemove(),delete this._maxLat,this._hideCoverage(),this._featureGroup.remove(),this._nonPointGroup.remove(),this._featureGroup.clearLayers(),this._map=null},getVisibleParent:function(t){for(var e=t;e&&!e._icon;)e=e.__parent;return e||null},_arraySplice:function(t,e){for(var n=t.length-1;n>=0;n--)if(t[n]===e)return t.splice(n,1),!0},_removeFromGridUnclustered:function(t,e){for(var n=this._map,s=this._gridUnclustered,a=Math.floor(this._map.getMinZoom());e>=a&&s[e].removeObject(t,n.project(t.getLatLng(),e));e--);},_childMarkerDragStart:function(t){t.target.__dragStart=t.target._latlng},_childMarkerMoved:function(t){if(!this._ignoreMove&&!t.target.__dragStart){var e=t.target._popup&&t.target._popup.isOpen();this._moveChild(t.target,t.oldLatLng,t.latlng),e&&t.target.openPopup()}},_moveChild:function(t,e,n){t._latlng=e,this.removeLayer(t),t._latlng=n,this.addLayer(t)},_childMarkerDragEnd:function(t){var e=t.target.__dragStart;delete t.target.__dragStart,e&&this._moveChild(t.target,e,t.target._latlng)},_removeLayer:function(t,e,n){var s=this._gridClusters,a=this._gridUnclustered,d=this._featureGroup,u=this._map,c=Math.floor(this._map.getMinZoom());e&&this._removeFromGridUnclustered(t,this._maxZoom);var f=t.__parent,p=f._markers,_;for(this._arraySplice(p,t);f&&(f._childCount--,f._boundsNeedUpdate=!0,!(f._zoom<c));)e&&f._childCount<=1?(_=f._markers[0]===t?f._markers[1]:f._markers[0],s[f._zoom].removeObject(f,u.project(f._cLatLng,f._zoom)),a[f._zoom].addObject(_,u.project(_.getLatLng(),f._zoom)),this._arraySplice(f.__parent._childClusters,f),f.__parent._markers.push(_),_.__parent=f.__parent,f._icon&&(d.removeLayer(f),n||d.addLayer(_))):f._iconNeedsUpdate=!0,f=f.__parent;delete t.__parent},_isOrIsParent:function(t,e){for(;e;){if(t===e)return!0;e=e.parentNode}return!1},fire:function(t,e,n){if(e&&e.layer instanceof L.MarkerCluster){if(e.originalEvent&&this._isOrIsParent(e.layer._icon,e.originalEvent.relatedTarget))return;t="cluster"+t}L.FeatureGroup.prototype.fire.call(this,t,e,n)},listens:function(t,e){return L.FeatureGroup.prototype.listens.call(this,t,e)||L.FeatureGroup.prototype.listens.call(this,"cluster"+t,e)},_defaultIconCreateFunction:function(t){var e=t.getChildCount(),n=" marker-cluster-";return e<10?n+="small":e<100?n+="medium":n+="large",new L.DivIcon({html:"<div><span>"+e+"</span></div>",className:"marker-cluster"+n,iconSize:new L.Point(40,40)})},_bindEvents:function(){var t=this._map,e=this.options.spiderfyOnMaxZoom,n=this.options.showCoverageOnHover,s=this.options.zoomToBoundsOnClick,a=this.options.spiderfyOnEveryZoom;(e||s||a)&&this.on("clusterclick clusterkeypress",this._zoomOrSpiderfy,this),n&&(this.on("clustermouseover",this._showCoverage,this),this.on("clustermouseout",this._hideCoverage,this),t.on("zoomend",this._hideCoverage,this))},_zoomOrSpiderfy:function(t){var e=t.layer,n=e;if(!(t.type==="clusterkeypress"&&t.originalEvent&&t.originalEvent.keyCode!==13)){for(;n._childClusters.length===1;)n=n._childClusters[0];n._zoom===this._maxZoom&&n._childCount===e._childCount&&this.options.spiderfyOnMaxZoom?e.spiderfy():this.options.zoomToBoundsOnClick&&e.zoomToBounds(),this.options.spiderfyOnEveryZoom&&e.spiderfy(),t.originalEvent&&t.originalEvent.keyCode===13&&this._map._container.focus()}},_showCoverage:function(t){var e=this._map;this._inZoomAnimation||(this._shownPolygon&&e.removeLayer(this._shownPolygon),t.layer.getChildCount()>2&&t.layer!==this._spiderfied&&(this._shownPolygon=new L.Polygon(t.layer.getConvexHull(),this.options.polygonOptions),e.addLayer(this._shownPolygon)))},_hideCoverage:function(){this._shownPolygon&&(this._map.removeLayer(this._shownPolygon),this._shownPolygon=null)},_unbindEvents:function(){var t=this.options.spiderfyOnMaxZoom,e=this.options.showCoverageOnHover,n=this.options.zoomToBoundsOnClick,s=this.options.spiderfyOnEveryZoom,a=this._map;(t||n||s)&&this.off("clusterclick clusterkeypress",this._zoomOrSpiderfy,this),e&&(this.off("clustermouseover",this._showCoverage,this),this.off("clustermouseout",this._hideCoverage,this),a.off("zoomend",this._hideCoverage,this))},_zoomEnd:function(){this._map&&(this._mergeSplitClusters(),this._zoom=Math.round(this._map._zoom),this._currentShownBounds=this._getExpandedVisibleBounds())},_moveEnd:function(){if(!this._inZoomAnimation){var t=this._getExpandedVisibleBounds();this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),this._zoom,t),this._topClusterLevel._recursivelyAddChildrenToMap(null,Math.round(this._map._zoom),t),this._currentShownBounds=t}},_generateInitialClusters:function(){var t=Math.ceil(this._map.getMaxZoom()),e=Math.floor(this._map.getMinZoom()),n=this.options.maxClusterRadius,s=n;typeof n!="function"&&(s=function(){return n}),this.options.disableClusteringAtZoom!==null&&(t=this.options.disableClusteringAtZoom-1),this._maxZoom=t,this._gridClusters={},this._gridUnclustered={};for(var a=t;a>=e;a--)this._gridClusters[a]=new L.DistanceGrid(s(a)),this._gridUnclustered[a]=new L.DistanceGrid(s(a));this._topClusterLevel=new this._markerCluster(this,e-1)},_addLayer:function(t,e){var n=this._gridClusters,s=this._gridUnclustered,a=Math.floor(this._map.getMinZoom()),d,u;for(this.options.singleMarkerMode&&this._overrideMarkerIcon(t),t.on(this._childMarkerEventHandlers,this);e>=a;e--){d=this._map.project(t.getLatLng(),e);var c=n[e].getNearObject(d);if(c){c._addChild(t),t.__parent=c;return}if(c=s[e].getNearObject(d),c){var f=c.__parent;f&&this._removeLayer(c,!1);var p=new this._markerCluster(this,e,c,t);n[e].addObject(p,this._map.project(p._cLatLng,e)),c.__parent=p,t.__parent=p;var _=p;for(u=e-1;u>f._zoom;u--)_=new this._markerCluster(this,u,_),n[u].addObject(_,this._map.project(c.getLatLng(),u));f._addChild(_),this._removeFromGridUnclustered(c,e);return}s[e].addObject(t,d)}this._topClusterLevel._addChild(t),t.__parent=this._topClusterLevel},_refreshClustersIcons:function(){this._featureGroup.eachLayer(function(t){t instanceof L.MarkerCluster&&t._iconNeedsUpdate&&t._updateIcon()})},_enqueue:function(t){this._queue.push(t),this._queueTimeout||(this._queueTimeout=setTimeout(L.bind(this._processQueue,this),300))},_processQueue:function(){for(var t=0;t<this._queue.length;t++)this._queue[t].call(this);this._queue.length=0,clearTimeout(this._queueTimeout),this._queueTimeout=null},_mergeSplitClusters:function(){var t=Math.round(this._map._zoom);this._processQueue(),this._zoom<t&&this._currentShownBounds.intersects(this._getExpandedVisibleBounds())?(this._animationStart(),this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),this._zoom,this._getExpandedVisibleBounds()),this._animationZoomIn(this._zoom,t)):this._zoom>t?(this._animationStart(),this._animationZoomOut(this._zoom,t)):this._moveEnd()},_getExpandedVisibleBounds:function(){if(this.options.removeOutsideVisibleBounds){if(L.Browser.mobile)return this._checkBoundsMaxLat(this._map.getBounds())}else return this._mapBoundsInfinite;return this._checkBoundsMaxLat(this._map.getBounds().pad(1))},_checkBoundsMaxLat:function(t){var e=this._maxLat;return e!==void 0&&(t.getNorth()>=e&&(t._northEast.lat=1/0),t.getSouth()<=-e&&(t._southWest.lat=-1/0)),t},_animationAddLayerNonAnimated:function(t,e){if(e===t)this._featureGroup.addLayer(t);else if(e._childCount===2){e._addToMap();var n=e.getAllChildMarkers();this._featureGroup.removeLayer(n[0]),this._featureGroup.removeLayer(n[1])}else e._updateIcon()},_extractNonGroupLayers:function(t,e){var n=t.getLayers(),s=0,a;for(e=e||[];s<n.length;s++){if(a=n[s],a instanceof L.LayerGroup){this._extractNonGroupLayers(a,e);continue}e.push(a)}return e},_overrideMarkerIcon:function(t){var e=t.options.icon=this.options.iconCreateFunction({getChildCount:function(){return 1},getAllChildMarkers:function(){return[t]}});return e}});L.MarkerClusterGroup.include({_mapBoundsInfinite:new L.LatLngBounds(new L.LatLng(-1/0,-1/0),new L.LatLng(1/0,1/0))}),L.MarkerClusterGroup.include({_noAnimation:{_animationStart:function(){},_animationZoomIn:function(t,e){this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),t),this._topClusterLevel._recursivelyAddChildrenToMap(null,e,this._getExpandedVisibleBounds()),this.fire("animationend")},_animationZoomOut:function(t,e){this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),t),this._topClusterLevel._recursivelyAddChildrenToMap(null,e,this._getExpandedVisibleBounds()),this.fire("animationend")},_animationAddLayer:function(t,e){this._animationAddLayerNonAnimated(t,e)}},_withAnimation:{_animationStart:function(){this._map._mapPane.className+=" leaflet-cluster-anim",this._inZoomAnimation++},_animationZoomIn:function(t,e){var n=this._getExpandedVisibleBounds(),s=this._featureGroup,a=Math.floor(this._map.getMinZoom()),d;this._ignoreMove=!0,this._topClusterLevel._recursively(n,t,a,function(u){var c=u._latlng,f=u._markers,p;for(n.contains(c)||(c=null),u._isSingleParent()&&t+1===e?(s.removeLayer(u),u._recursivelyAddChildrenToMap(null,e,n)):(u.clusterHide(),u._recursivelyAddChildrenToMap(c,e,n)),d=f.length-1;d>=0;d--)p=f[d],n.contains(p._latlng)||s.removeLayer(p)}),this._forceLayout(),this._topClusterLevel._recursivelyBecomeVisible(n,e),s.eachLayer(function(u){!(u instanceof L.MarkerCluster)&&u._icon&&u.clusterShow()}),this._topClusterLevel._recursively(n,t,e,function(u){u._recursivelyRestoreChildPositions(e)}),this._ignoreMove=!1,this._enqueue(function(){this._topClusterLevel._recursively(n,t,a,function(u){s.removeLayer(u),u.clusterShow()}),this._animationEnd()})},_animationZoomOut:function(t,e){this._animationZoomOutSingle(this._topClusterLevel,t-1,e),this._topClusterLevel._recursivelyAddChildrenToMap(null,e,this._getExpandedVisibleBounds()),this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),t,this._getExpandedVisibleBounds())},_animationAddLayer:function(t,e){var n=this,s=this._featureGroup;s.addLayer(t),e!==t&&(e._childCount>2?(e._updateIcon(),this._forceLayout(),this._animationStart(),t._setPos(this._map.latLngToLayerPoint(e.getLatLng())),t.clusterHide(),this._enqueue(function(){s.removeLayer(t),t.clusterShow(),n._animationEnd()})):(this._forceLayout(),n._animationStart(),n._animationZoomOutSingle(e,this._map.getMaxZoom(),this._zoom)))}},_animationZoomOutSingle:function(t,e,n){var s=this._getExpandedVisibleBounds(),a=Math.floor(this._map.getMinZoom());t._recursivelyAnimateChildrenInAndAddSelfToMap(s,a,e+1,n);var d=this;this._forceLayout(),t._recursivelyBecomeVisible(s,n),this._enqueue(function(){if(t._childCount===1){var u=t._markers[0];this._ignoreMove=!0,u.setLatLng(u.getLatLng()),this._ignoreMove=!1,u.clusterShow&&u.clusterShow()}else t._recursively(s,n,a,function(c){c._recursivelyRemoveChildrenFromMap(s,a,e+1)});d._animationEnd()})},_animationEnd:function(){this._map&&(this._map._mapPane.className=this._map._mapPane.className.replace(" leaflet-cluster-anim","")),this._inZoomAnimation--,this.fire("animationend")},_forceLayout:function(){L.Util.falseFn(document.body.offsetWidth)}}),L.markerClusterGroup=function(t){return new L.MarkerClusterGroup(t)};var h=L.MarkerCluster=L.Marker.extend({options:L.Icon.prototype.options,initialize:function(t,e,n,s){L.Marker.prototype.initialize.call(this,n?n._cLatLng||n.getLatLng():new L.LatLng(0,0),{icon:this,pane:t.options.clusterPane}),this._group=t,this._zoom=e,this._markers=[],this._childClusters=[],this._childCount=0,this._iconNeedsUpdate=!0,this._boundsNeedUpdate=!0,this._bounds=new L.LatLngBounds,n&&this._addChild(n),s&&this._addChild(s)},getAllChildMarkers:function(t,e){t=t||[];for(var n=this._childClusters.length-1;n>=0;n--)this._childClusters[n].getAllChildMarkers(t,e);for(var s=this._markers.length-1;s>=0;s--)e&&this._markers[s].__dragStart||t.push(this._markers[s]);return t},getChildCount:function(){return this._childCount},zoomToBounds:function(t){for(var e=this._childClusters.slice(),n=this._group._map,s=n.getBoundsZoom(this._bounds),a=this._zoom+1,d=n.getZoom(),u;e.length>0&&s>a;){a++;var c=[];for(u=0;u<e.length;u++)c=c.concat(e[u]._childClusters);e=c}s>a?this._group._map.setView(this._latlng,a):s<=d?this._group._map.setView(this._latlng,d+1):this._group._map.fitBounds(this._bounds,t)},getBounds:function(){var t=new L.LatLngBounds;return t.extend(this._bounds),t},_updateIcon:function(){this._iconNeedsUpdate=!0,this._icon&&this.setIcon(this)},createIcon:function(){return this._iconNeedsUpdate&&(this._iconObj=this._group.options.iconCreateFunction(this),this._iconNeedsUpdate=!1),this._iconObj.createIcon()},createShadow:function(){return this._iconObj.createShadow()},_addChild:function(t,e){this._iconNeedsUpdate=!0,this._boundsNeedUpdate=!0,this._setClusterCenter(t),t instanceof L.MarkerCluster?(e||(this._childClusters.push(t),t.__parent=this),this._childCount+=t._childCount):(e||this._markers.push(t),this._childCount++),this.__parent&&this.__parent._addChild(t,!0)},_setClusterCenter:function(t){this._cLatLng||(this._cLatLng=t._cLatLng||t._latlng)},_resetBounds:function(){var t=this._bounds;t._southWest&&(t._southWest.lat=1/0,t._southWest.lng=1/0),t._northEast&&(t._northEast.lat=-1/0,t._northEast.lng=-1/0)},_recalculateBounds:function(){var t=this._markers,e=this._childClusters,n=0,s=0,a=this._childCount,d,u,c,f;if(a!==0){for(this._resetBounds(),d=0;d<t.length;d++)c=t[d]._latlng,this._bounds.extend(c),n+=c.lat,s+=c.lng;for(d=0;d<e.length;d++)u=e[d],u._boundsNeedUpdate&&u._recalculateBounds(),this._bounds.extend(u._bounds),c=u._wLatLng,f=u._childCount,n+=c.lat*f,s+=c.lng*f;this._latlng=this._wLatLng=new L.LatLng(n/a,s/a),this._boundsNeedUpdate=!1}},_addToMap:function(t){t&&(this._backupLatlng=this._latlng,this.setLatLng(t)),this._group._featureGroup.addLayer(this)},_recursivelyAnimateChildrenIn:function(t,e,n){this._recursively(t,this._group._map.getMinZoom(),n-1,function(s){var a=s._markers,d,u;for(d=a.length-1;d>=0;d--)u=a[d],u._icon&&(u._setPos(e),u.clusterHide())},function(s){var a=s._childClusters,d,u;for(d=a.length-1;d>=0;d--)u=a[d],u._icon&&(u._setPos(e),u.clusterHide())})},_recursivelyAnimateChildrenInAndAddSelfToMap:function(t,e,n,s){this._recursively(t,s,e,function(a){a._recursivelyAnimateChildrenIn(t,a._group._map.latLngToLayerPoint(a.getLatLng()).round(),n),a._isSingleParent()&&n-1===s?(a.clusterShow(),a._recursivelyRemoveChildrenFromMap(t,e,n)):a.clusterHide(),a._addToMap()})},_recursivelyBecomeVisible:function(t,e){this._recursively(t,this._group._map.getMinZoom(),e,null,function(n){n.clusterShow()})},_recursivelyAddChildrenToMap:function(t,e,n){this._recursively(n,this._group._map.getMinZoom()-1,e,function(s){if(e!==s._zoom)for(var a=s._markers.length-1;a>=0;a--){var d=s._markers[a];n.contains(d._latlng)&&(t&&(d._backupLatlng=d.getLatLng(),d.setLatLng(t),d.clusterHide&&d.clusterHide()),s._group._featureGroup.addLayer(d))}},function(s){s._addToMap(t)})},_recursivelyRestoreChildPositions:function(t){for(var e=this._markers.length-1;e>=0;e--){var n=this._markers[e];n._backupLatlng&&(n.setLatLng(n._backupLatlng),delete n._backupLatlng)}if(t-1===this._zoom)for(var s=this._childClusters.length-1;s>=0;s--)this._childClusters[s]._restorePosition();else for(var a=this._childClusters.length-1;a>=0;a--)this._childClusters[a]._recursivelyRestoreChildPositions(t)},_restorePosition:function(){this._backupLatlng&&(this.setLatLng(this._backupLatlng),delete this._backupLatlng)},_recursivelyRemoveChildrenFromMap:function(t,e,n,s){var a,d;this._recursively(t,e-1,n-1,function(u){for(d=u._markers.length-1;d>=0;d--)a=u._markers[d],(!s||!s.contains(a._latlng))&&(u._group._featureGroup.removeLayer(a),a.clusterShow&&a.clusterShow())},function(u){for(d=u._childClusters.length-1;d>=0;d--)a=u._childClusters[d],(!s||!s.contains(a._latlng))&&(u._group._featureGroup.removeLayer(a),a.clusterShow&&a.clusterShow())})},_recursively:function(t,e,n,s,a){var d=this._childClusters,u=this._zoom,c,f;if(e<=u&&(s&&s(this),a&&u===n&&a(this)),u<e||u<n)for(c=d.length-1;c>=0;c--)f=d[c],f._boundsNeedUpdate&&f._recalculateBounds(),t.intersects(f._bounds)&&f._recursively(t,e,n,s,a)},_isSingleParent:function(){return this._childClusters.length>0&&this._childClusters[0]._childCount===this._childCount}});L.Marker.include({clusterHide:function(){var t=this.options.opacity;return this.setOpacity(0),this.options.opacity=t,this},clusterShow:function(){return this.setOpacity(this.options.opacity)}}),L.DistanceGrid=function(t){this._cellSize=t,this._sqCellSize=t*t,this._grid={},this._objectPoint={}},L.DistanceGrid.prototype={addObject:function(t,e){var n=this._getCoord(e.x),s=this._getCoord(e.y),a=this._grid,d=a[s]=a[s]||{},u=d[n]=d[n]||[],c=L.Util.stamp(t);this._objectPoint[c]=e,u.push(t)},updateObject:function(t,e){this.removeObject(t),this.addObject(t,e)},removeObject:function(t,e){var n=this._getCoord(e.x),s=this._getCoord(e.y),a=this._grid,d=a[s]=a[s]||{},u=d[n]=d[n]||[],c,f;for(delete this._objectPoint[L.Util.stamp(t)],c=0,f=u.length;c<f;c++)if(u[c]===t)return u.splice(c,1),f===1&&delete d[n],!0},eachObject:function(t,e){var n,s,a,d,u,c,f,p=this._grid;for(n in p){u=p[n];for(s in u)for(c=u[s],a=0,d=c.length;a<d;a++)f=t.call(e,c[a]),f&&(a--,d--)}},getNearObject:function(t){var e=this._getCoord(t.x),n=this._getCoord(t.y),s,a,d,u,c,f,p,_,y=this._objectPoint,m=this._sqCellSize,g=null;for(s=n-1;s<=n+1;s++)if(u=this._grid[s],u){for(a=e-1;a<=e+1;a++)if(c=u[a],c)for(d=0,f=c.length;d<f;d++)p=c[d],_=this._sqDist(y[L.Util.stamp(p)],t),(_<m||_<=m&&g===null)&&(m=_,g=p)}return g},_getCoord:function(t){var e=Math.floor(t/this._cellSize);return isFinite(e)?e:t},_sqDist:function(t,e){var n=e.x-t.x,s=e.y-t.y;return n*n+s*s}},function(){L.QuickHull={getDistant:function(t,e){var n=e[1].lat-e[0].lat,s=e[0].lng-e[1].lng;return s*(t.lat-e[0].lat)+n*(t.lng-e[0].lng)},findMostDistantPointFromBaseLine:function(t,e){var n=0,s=null,a=[],d,u,c;for(d=e.length-1;d>=0;d--){if(u=e[d],c=this.getDistant(u,t),c>0)a.push(u);else continue;c>n&&(n=c,s=u)}return{maxPoint:s,newPoints:a}},buildConvexHull:function(t,e){var n=[],s=this.findMostDistantPointFromBaseLine(t,e);return s.maxPoint?(n=n.concat(this.buildConvexHull([t[0],s.maxPoint],s.newPoints)),n=n.concat(this.buildConvexHull([s.maxPoint,t[1]],s.newPoints)),n):[t[0]]},getConvexHull:function(t){var e=!1,n=!1,s=!1,a=!1,d=null,u=null,c=null,f=null,p=null,_=null,y;for(y=t.length-1;y>=0;y--){var m=t[y];(e===!1||m.lat>e)&&(d=m,e=m.lat),(n===!1||m.lat<n)&&(u=m,n=m.lat),(s===!1||m.lng>s)&&(c=m,s=m.lng),(a===!1||m.lng<a)&&(f=m,a=m.lng)}n!==e?(_=u,p=d):(_=f,p=c);var g=[].concat(this.buildConvexHull([_,p],t),this.buildConvexHull([p,_],t));return g}}}(),L.MarkerCluster.include({getConvexHull:function(){var t=this.getAllChildMarkers(),e=[],n,s;for(s=t.length-1;s>=0;s--)n=t[s].getLatLng(),e.push(n);return L.QuickHull.getConvexHull(e)}}),L.MarkerCluster.include({_2PI:Math.PI*2,_circleFootSeparation:25,_circleStartAngle:0,_spiralFootSeparation:28,_spiralLengthStart:11,_spiralLengthFactor:5,_circleSpiralSwitchover:9,spiderfy:function(){if(!(this._group._spiderfied===this||this._group._inZoomAnimation)){var t=this.getAllChildMarkers(null,!0),e=this._group,n=e._map,s=n.latLngToLayerPoint(this._latlng),a;this._group._unspiderfy(),this._group._spiderfied=this,this._group.options.spiderfyShapePositions?a=this._group.options.spiderfyShapePositions(t.length,s):t.length>=this._circleSpiralSwitchover?a=this._generatePointsSpiral(t.length,s):(s.y+=10,a=this._generatePointsCircle(t.length,s)),this._animationSpiderfy(t,a)}},unspiderfy:function(t){this._group._inZoomAnimation||(this._animationUnspiderfy(t),this._group._spiderfied=null)},_generatePointsCircle:function(t,e){var n=this._group.options.spiderfyDistanceMultiplier*this._circleFootSeparation*(2+t),s=n/this._2PI,a=this._2PI/t,d=[],u,c;for(s=Math.max(s,35),d.length=t,u=0;u<t;u++)c=this._circleStartAngle+u*a,d[u]=new L.Point(e.x+s*Math.cos(c),e.y+s*Math.sin(c))._round();return d},_generatePointsSpiral:function(t,e){var n=this._group.options.spiderfyDistanceMultiplier,s=n*this._spiralLengthStart,a=n*this._spiralFootSeparation,d=n*this._spiralLengthFactor*this._2PI,u=0,c=[],f;for(c.length=t,f=t;f>=0;f--)f<t&&(c[f]=new L.Point(e.x+s*Math.cos(u),e.y+s*Math.sin(u))._round()),u+=a/s+f*5e-4,s+=d/u;return c},_noanimationUnspiderfy:function(){var t=this._group,e=t._map,n=t._featureGroup,s=this.getAllChildMarkers(null,!0),a,d;for(t._ignoreMove=!0,this.setOpacity(1),d=s.length-1;d>=0;d--)a=s[d],n.removeLayer(a),a._preSpiderfyLatlng&&(a.setLatLng(a._preSpiderfyLatlng),delete a._preSpiderfyLatlng),a.setZIndexOffset&&a.setZIndexOffset(0),a._spiderLeg&&(e.removeLayer(a._spiderLeg),delete a._spiderLeg);t.fire("unspiderfied",{cluster:this,markers:s}),t._ignoreMove=!1,t._spiderfied=null}}),L.MarkerClusterNonAnimated=L.MarkerCluster.extend({_animationSpiderfy:function(t,e){var n=this._group,s=n._map,a=n._featureGroup,d=this._group.options.spiderLegPolylineOptions,u,c,f,p;for(n._ignoreMove=!0,u=0;u<t.length;u++)p=s.layerPointToLatLng(e[u]),c=t[u],f=new L.Polyline([this._latlng,p],d),s.addLayer(f),c._spiderLeg=f,c._preSpiderfyLatlng=c._latlng,c.setLatLng(p),c.setZIndexOffset&&c.setZIndexOffset(1e6),a.addLayer(c);this.setOpacity(.3),n._ignoreMove=!1,n.fire("spiderfied",{cluster:this,markers:t})},_animationUnspiderfy:function(){this._noanimationUnspiderfy()}}),L.MarkerCluster.include({_animationSpiderfy:function(t,e){var n=this,s=this._group,a=s._map,d=s._featureGroup,u=this._latlng,c=a.latLngToLayerPoint(u),f=L.Path.SVG,p=L.extend({},this._group.options.spiderLegPolylineOptions),_=p.opacity,y,m,g,v,w,S;for(_===void 0&&(_=L.MarkerClusterGroup.prototype.options.spiderLegPolylineOptions.opacity),f?(p.opacity=0,p.className=(p.className||"")+" leaflet-cluster-spider-leg"):p.opacity=_,s._ignoreMove=!0,y=0;y<t.length;y++)m=t[y],S=a.layerPointToLatLng(e[y]),g=new L.Polyline([u,S],p),a.addLayer(g),m._spiderLeg=g,f&&(v=g._path,w=v.getTotalLength()+.1,v.style.strokeDasharray=w,v.style.strokeDashoffset=w),m.setZIndexOffset&&m.setZIndexOffset(1e6),m.clusterHide&&m.clusterHide(),d.addLayer(m),m._setPos&&m._setPos(c);for(s._forceLayout(),s._animationStart(),y=t.length-1;y>=0;y--)S=a.layerPointToLatLng(e[y]),m=t[y],m._preSpiderfyLatlng=m._latlng,m.setLatLng(S),m.clusterShow&&m.clusterShow(),f&&(g=m._spiderLeg,v=g._path,v.style.strokeDashoffset=0,g.setStyle({opacity:_}));this.setOpacity(.3),s._ignoreMove=!1,setTimeout(function(){s._animationEnd(),s.fire("spiderfied",{cluster:n,markers:t})},200)},_animationUnspiderfy:function(t){var e=this,n=this._group,s=n._map,a=n._featureGroup,d=t?s._latLngToNewLayerPoint(this._latlng,t.zoom,t.center):s.latLngToLayerPoint(this._latlng),u=this.getAllChildMarkers(null,!0),c=L.Path.SVG,f,p,_,y,m,g;for(n._ignoreMove=!0,n._animationStart(),this.setOpacity(1),p=u.length-1;p>=0;p--)f=u[p],f._preSpiderfyLatlng&&(f.closePopup(),f.setLatLng(f._preSpiderfyLatlng),delete f._preSpiderfyLatlng,g=!0,f._setPos&&(f._setPos(d),g=!1),f.clusterHide&&(f.clusterHide(),g=!1),g&&a.removeLayer(f),c&&(_=f._spiderLeg,y=_._path,m=y.getTotalLength()+.1,y.style.strokeDashoffset=m,_.setStyle({opacity:0})));n._ignoreMove=!1,setTimeout(function(){var v=0;for(p=u.length-1;p>=0;p--)f=u[p],f._spiderLeg&&v++;for(p=u.length-1;p>=0;p--)f=u[p],f._spiderLeg&&(f.clusterShow&&f.clusterShow(),f.setZIndexOffset&&f.setZIndexOffset(0),v>1&&a.removeLayer(f),s.removeLayer(f._spiderLeg),delete f._spiderLeg);n._animationEnd(),n.fire("unspiderfied",{cluster:e,markers:u})},200)}}),L.MarkerClusterGroup.include({_spiderfied:null,unspiderfy:function(){this._unspiderfy.apply(this,arguments)},_spiderfierOnAdd:function(){this._map.on("click",this._unspiderfyWrapper,this),this._map.options.zoomAnimation&&this._map.on("zoomstart",this._unspiderfyZoomStart,this),this._map.on("zoomend",this._noanimationUnspiderfy,this),L.Browser.touch||this._map.getRenderer(this)},_spiderfierOnRemove:function(){this._map.off("click",this._unspiderfyWrapper,this),this._map.off("zoomstart",this._unspiderfyZoomStart,this),this._map.off("zoomanim",this._unspiderfyZoomAnim,this),this._map.off("zoomend",this._noanimationUnspiderfy,this),this._noanimationUnspiderfy()},_unspiderfyZoomStart:function(){this._map&&this._map.on("zoomanim",this._unspiderfyZoomAnim,this)},_unspiderfyZoomAnim:function(t){L.DomUtil.hasClass(this._map._mapPane,"leaflet-touching")||(this._map.off("zoomanim",this._unspiderfyZoomAnim,this),this._unspiderfy(t))},_unspiderfyWrapper:function(){this._unspiderfy()},_unspiderfy:function(t){this._spiderfied&&this._spiderfied.unspiderfy(t)},_noanimationUnspiderfy:function(){this._spiderfied&&this._spiderfied._noanimationUnspiderfy()},_unspiderfyLayer:function(t){t._spiderLeg&&(this._featureGroup.removeLayer(t),t.clusterShow&&t.clusterShow(),t.setZIndexOffset&&t.setZIndexOffset(0),this._map.removeLayer(t._spiderLeg),delete t._spiderLeg)}}),L.MarkerClusterGroup.include({refreshClusters:function(t){return t?t instanceof L.MarkerClusterGroup?t=t._topClusterLevel.getAllChildMarkers():t instanceof L.LayerGroup?t=t._layers:t instanceof L.MarkerCluster?t=t.getAllChildMarkers():t instanceof L.Marker&&(t=[t]):t=this._topClusterLevel.getAllChildMarkers(),this._flagParentsIconsNeedUpdate(t),this._refreshClustersIcons(),this.options.singleMarkerMode&&this._refreshSingleMarkerModeMarkers(t),this},_flagParentsIconsNeedUpdate:function(t){var e,n;for(e in t)for(n=t[e].__parent;n;)n._iconNeedsUpdate=!0,n=n.__parent},_refreshSingleMarkerModeMarkers:function(t){var e,n;for(e in t)n=t[e],this.hasLayer(n)&&n.setIcon(this._overrideMarkerIcon(n))}}),L.Marker.include({refreshIconOptions:function(t,e){var n=this.options.icon;return L.setOptions(n,t),this.setIcon(n),e&&this.__parent&&this.__parent._group.refreshClusters(this),this}}),r.MarkerClusterGroup=l,r.MarkerCluster=h,Object.defineProperty(r,"__esModule",{value:!0})})}(F,F.exports)),F.exports}Xt();var $={exports:{}};/*!
 Leaflet.MarkerCluster.LayerSupport 2.0.1+649b3a9
 (c) 2015-2018 Boris Seang
 License MIT
 */var Qt=$.exports,at;function Kt(){return at||(at=1,function(o){(function(i,r){r(o.exports?$t():i.L)})(Qt,function(i,r){i.MarkerClusterGroup.LayerSupport=i.MarkerClusterGroup.extend({options:{singleAddRemoveBufferDuration:0},initialize:function(e){i.MarkerClusterGroup.prototype.initialize.call(this,e),this._featureGroup=new l,this._featureGroup.addEventParent(this),this._nonPointGroup=new l,this._nonPointGroup.addEventParent(this),this._layers={},this._proxyLayerGroups={},this._proxyLayerGroupsNeedRemoving={},this._singleAddRemoveBuffer=[]},checkIn:function(e){var n=this._toArray(e);return this._checkInGetSeparated(n),this},checkOut:function(e){var n,s,a=this._toArray(e),d=this._separateSingleFromGroupLayers(a,{groups:[],singles:[]}),u=d.groups,c=d.singles;for(n=0;n<c.length;n++)s=c[n],delete this._layers[i.stamp(s)],delete s._mcgLayerSupportGroup;for(this._originalRemoveLayers(c),n=0;n<u.length;n++)s=u[n],this._dismissProxyLayerGroup(s);return this},addLayers:function(e){var n,s,a,d=this._toArray(e),u=this._checkInGetSeparated(d),c=u.groups;for(this._originalAddLayers(u.singles),n=0;n<c.length;n++)s=c[n],a=i.stamp(s),this._proxyLayerGroups[a]=s,delete this._proxyLayerGroupsNeedRemoving[a],this._map&&this._map._originalAddLayer(s)},addLayer:function(e){return this._bufferSingleAddRemove(e,"addLayers"),this},_originalAddLayer:i.MarkerClusterGroup.prototype.addLayer,_originalAddLayers:i.MarkerClusterGroup.prototype.addLayers,removeLayers:function(e){var n,s,a=this._toArray(e),d=this._separateSingleFromGroupLayers(a,{groups:[],singles:[]}),u=d.groups,c=d.singles,f=0;for(this._originalRemoveLayers(c);f<u.length;f++)n=u[f],s=i.stamp(n),delete this._proxyLayerGroups[s],this._map?this._map._originalRemoveLayer(n):this._proxyLayerGroupsNeedRemoving[s]=n;return this},removeLayer:function(e){return this._bufferSingleAddRemove(e,"removeLayers"),this},_originalRemoveLayer:i.MarkerClusterGroup.prototype.removeLayer,_originalRemoveLayers:i.MarkerClusterGroup.prototype.removeLayers,onAdd:function(e){e._originalAddLayer=e._originalAddLayer||e.addLayer,e._originalRemoveLayer=e._originalRemoveLayer||e.removeLayer,i.extend(e,t);var n,s,a,d=this._removePreAddedLayers(e);this._originalOnAdd.call(this,e);for(n in this._proxyLayerGroups)s=this._proxyLayerGroups[n],e._originalAddLayer(s);for(n in this._proxyLayerGroupsNeedRemoving)s=this._proxyLayerGroupsNeedRemoving[n],e._originalRemoveLayer(s),delete this._proxyLayerGroupsNeedRemoving[n];for(a=0;a<d.length;a++)e.addLayer(d[a])},_originalOnAdd:i.MarkerClusterGroup.prototype.onAdd,_bufferSingleAddRemove:function(e,n){var s,a=this.options.singleAddRemoveBufferDuration;a>0?(this._singleAddRemoveBuffer.push({type:n,layer:e}),this._singleAddRemoveBufferTimeout||(s=i.bind(this._processSingleAddRemoveBuffer,this),this._singleAddRemoveBufferTimeout=setTimeout(s,a))):this[n](e)},_processSingleAddRemoveBuffer:function(){for(var e,n,s=this._singleAddRemoveBuffer,a=0,d=[];a<s.length;a++)e=s[a],n||(n=e.type),e.type===n?d.push(e.layer):(this[n](d),n=e.type,d=[e.layer]);this[n](d),s.length=0,clearTimeout(this._singleAddRemoveBufferTimeout),this._singleAddRemoveBufferTimeout=null},_checkInGetSeparated:function(e){var n,s,a=this._separateSingleFromGroupLayers(e,{groups:[],singles:[]}),d=a.groups,u=a.singles;for(n=0;n<d.length;n++)s=d[n],this._recruitLayerGroupAsProxy(s);for(n=0;n<u.length;n++)s=u[n],this._removeFromOtherGroupsOrMap(s),this._layers[i.stamp(s)]=s,s._mcgLayerSupportGroup=this;return a},_separateSingleFromGroupLayers:function(e,n){for(var s,a=n.groups,d=n.singles,u=i.Util.isArray,c=0;c<e.length;c++)s=e[c],s instanceof i.LayerGroup?(a.push(s),this._separateSingleFromGroupLayers(s.getLayers(),n)):u(s)?this._separateSingleFromGroupLayers(s,n):d.push(s);return n},_recruitLayerGroupAsProxy:function(e){var n=e._proxyMcgLayerSupportGroup;if(n){if(n===this)return;n.checkOut(e)}else this._removeFromOwnMap(e);e._proxyMcgLayerSupportGroup=this,e._originalAddLayer=e._originalAddLayer||e.addLayer,e._originalRemoveLayer=e._originalRemoveLayer||e.removeLayer,e._originalOnAdd=e._originalOnAdd||e.onAdd,e._originalOnRemove=e._originalOnRemove||e.onRemove,i.extend(e,h)},_dismissProxyLayerGroup:function(e){if(e._proxyMcgLayerSupportGroup!==r&&e._proxyMcgLayerSupportGroup===this){delete e._proxyMcgLayerSupportGroup,e.addLayer=e._originalAddLayer,e.removeLayer=e._originalRemoveLayer,e.onAdd=e._originalOnAdd,e.onRemove=e._originalOnRemove;var n=i.stamp(e);delete this._proxyLayerGroups[n],delete this._proxyLayerGroupsNeedRemoving[n],this._removeFromOwnMap(e)}},_removeFromOtherGroupsOrMap:function(e){var n=e._mcgLayerSupportGroup;if(n){if(n===this)return;n.checkOut(e)}else e.__parent?e.__parent._group.removeLayer(e):this._removeFromOwnMap(e)},_removeFromOwnMap:function(e){e._map&&e._map.removeLayer(e)},_removePreAddedLayers:function(e){var n,s=this._layers,a=[];for(var d in s)n=s[d],n._map&&(a.push(n),e._originalRemoveLayer(n));return a},_toArray:function(e){return i.Util.isArray(e)?e:[e]}});var l=i.FeatureGroup.extend({addLayer:function(e){if(this.hasLayer(e))return this;e.addEventParent(this);var n=i.stamp(e);return this._layers[n]=e,this._map&&this._map._originalAddLayer(e),this.fire("layeradd",{layer:e})},removeLayer:function(e){if(!this.hasLayer(e))return this;e in this._layers&&(e=this._layers[e]),e.removeEventParent(this);var n=i.stamp(e);return this._map&&this._layers[n]&&this._map._originalRemoveLayer(this._layers[n]),delete this._layers[n],this.fire("layerremove",{layer:e})},onAdd:function(e){this._map=e,this.eachLayer(e._originalAddLayer,e)},onRemove:function(e){this.eachLayer(e._originalRemoveLayer,e),this._map=null}}),h={addLayer:function(e){var n=this.getLayerId(e);return this._layers[n]=e,this._map?this._proxyMcgLayerSupportGroup.addLayer(e):this._proxyMcgLayerSupportGroup.checkIn(e),this},removeLayer:function(e){var n=e in this._layers?e:this.getLayerId(e);return this._proxyMcgLayerSupportGroup.removeLayer(e),delete this._layers[n],this},onAdd:function(){this._proxyMcgLayerSupportGroup.addLayers(this.getLayers())},onRemove:function(){this._proxyMcgLayerSupportGroup.removeLayers(this.getLayers())}},t={addLayer:function(e){return e._mcgLayerSupportGroup?e._mcgLayerSupportGroup._originalAddLayer(e):this._originalAddLayer(e)},removeLayer:function(e){return e._mcgLayerSupportGroup?e._mcgLayerSupportGroup._originalRemoveLayer(e):this._originalRemoveLayer(e)}};i.markerClusterGroup.layerSupport=function(e){return new i.MarkerClusterGroup.LayerSupport(e)}})}($)),$.exports}Kt();class C{constructor(i,r){this.lat=r,this.lng=i}}class O{constructor(i,r,l,h,t){this.northEastCoord=i,this.northWestCoord=r,this.southEastCoord=l,this.southWestCoord=h,this.northEastChild=void 0,this.northWestChild=void 0,this.southEastChild=void 0,this.southWestChild=void 0,this.values=[],this.maxCapacity=t,this.verbose=!1}json(){return JSON.stringify({ne:this.northEastCoord,nw:this.northWestCoord,se:this.southEastCoord,sw:this.southWestCoord})}static empty(i=100){return new O(new C(180,90),new C(-180,90),new C(180,-90),new C(-180,-90),i)}belongs(i){return this.belongsLatLng(i.lat,i.lng)}belongsLatLng(i,r){return r<=this.northEastCoord.lng&&r>this.northWestCoord.lng&&i<=this.northWestCoord.lat&&i>this.southWestCoord.lat}insertLatLng(i,r){return this.insert(new C(r,i))}insert(i){if(!this.belongs(i))return!1;if(this.hasChildNodes()){const r=this.northEastChild.insert(i),l=this.northWestChild.insert(i),h=this.southEastChild.insert(i),t=this.southWestChild.insert(i);return this.verbose&&console.log(`Item ${JSON.stringify(i)} inserted in NE:${r}, NW:·${l}, SE:${h}, SW:${t}`),r||l||h||t}else{if(this.verbose&&console.log(`Insert ${JSON.stringify(i)} into ${this.json()}`),this.values.push(i),this.values.length>=this.maxCapacity){this.verbose&&console.log("Splitting into four nodes more ...."),this.northEastChild=new O(this.northEastCoord,new C((this.northEastCoord.lng+this.northWestCoord.lng)/2,this.northEastCoord.lat),new C(this.southEastCoord.lng,(this.northEastCoord.lat+this.southEastCoord.lat)/2),new C((this.northEastCoord.lng+this.northWestCoord.lng)/2,(this.northEastCoord.lat+this.southEastCoord.lat)/2),this.maxCapacity),this.northWestChild=new O(new C((this.northEastCoord.lng+this.northWestCoord.lng)/2,this.northEastCoord.lat),this.northWestCoord,new C((this.northEastCoord.lng+this.northWestCoord.lng)/2,(this.northEastCoord.lat+this.southEastCoord.lat)/2),new C(this.northWestCoord.lng,(this.northWestCoord.lat+this.southWestCoord.lat)/2),this.maxCapacity),this.southEastChild=new O(new C(this.northEastCoord.lng,(this.northEastCoord.lat+this.southEastCoord.lat)/2),new C((this.northEastCoord.lng+this.northWestCoord.lng)/2,(this.northEastCoord.lat+this.southEastCoord.lat)/2),this.southEastCoord,new C((this.southEastCoord.lng+this.southWestCoord.lng)/2,this.southEastCoord.lat),this.maxCapacity),this.southWestChild=new O(new C((this.northEastCoord.lng+this.northWestCoord.lng)/2,(this.northEastCoord.lat+this.southEastCoord.lat)/2),new C(this.northWestCoord.lng,(this.northWestCoord.lat+this.southWestCoord.lat)/2),new C((this.southEastCoord.lng+this.southWestCoord.lng)/2,this.southWestCoord.lat),this.southWestCoord,this.maxCapacity);for(let r of this.values){const l=this.northEastChild.insert(r),h=this.northWestChild.insert(r),t=this.southEastChild.insert(r),e=this.southWestChild.insert(r);this.verbose&&console.log(`Item ${JSON.stringify(r)} inserted in NE:${l}, NW:·${h}, SE:${t}, SW:${e}`)}this.verbose&&console.log(`Reset items in ${JSON.stringify(this.json())}`),this.values=[]}return!0}}hasChildNodes(){return this.northEastChild!=null&&this.northWestChild!=null&&this.southEastChild!=null&&this.southWestChild!=null}locationIsOnTree(i,r,l){return this.lngLatIsOnTree(new C(r,i),l)}lngLatIsOnTree(i,r=10){if(!this.belongs(i))return!1;if(this.hasChildNodes())return this.northEastChild.lngLatIsOnTree(i,r)||this.southEastChild.lngLatIsOnTree(i,r)||this.northWestChild.lngLatIsOnTree(i,r)||this.southWestChild.lngLatIsOnTree(i,r);for(let l of this.values)if(this.equalsWithTolerance(i,l,r))return!0;return!1}equalsWithTolerance(i,r,l){const{lat_drift_allowed:h,lng_drift_allowed:t}=this.latLngTolerance(i.lat,i.lng,l),e=Math.abs(i.lat-r.lat),n=Math.abs(i.lng-r.lng);return e<=h&&n<=t}latLngTolerance(i,r,l){const h=l/111320,t=h,e=h/Math.cos(i*.01745);return{lat_drift_allowed:t,lng_drift_allowed:e}}points(){let i=[];for(let r of this.values)i.push([r.lat,r.lng]);return this._addPoints(this.northEastChild,i),this._addPoints(this.northWestChild,i),this._addPoints(this.southEastChild,i),this._addPoints(this.southWestChild,i),i}_addPoints(i,r){if(i)for(let l of i.points())r.push(l)}serialize(){return JSON.stringify(this.toObject())}toObject(){return{northEastCoord:this.northEastCoord,northWestCoord:this.northWestCoord,southEastCoord:this.southEastCoord,southWestCoord:this.southWestCoord,values:this.values,maxCapacity:this.maxCapacity,hasChildren:this.hasChildNodes(),northEastChild:this.northEastChild?this.northEastChild.toObject():null,northWestChild:this.northWestChild?this.northWestChild.toObject():null,southEastChild:this.southEastChild?this.southEastChild.toObject():null,southWestChild:this.southWestChild?this.southWestChild.toObject():null}}static deserialize(i){const r=JSON.parse(i);return this.fromObject(r)}static fromObject(i){const r=new O(new C(i.northEastCoord.lng,i.northEastCoord.lat),new C(i.northWestCoord.lng,i.northWestCoord.lat),new C(i.southEastCoord.lng,i.southEastCoord.lat),new C(i.southWestCoord.lng,i.southWestCoord.lat),i.maxCapacity);return r.values=i.values.map(l=>new C(l.lng,l.lat)),i.northEastChild&&(r.northEastChild=this.fromObject(i.northEastChild)),i.northWestChild&&(r.northWestChild=this.fromObject(i.northWestChild)),i.southEastChild&&(r.southEastChild=this.fromObject(i.southEastChild)),i.southWestChild&&(r.southWestChild=this.fromObject(i.southWestChild)),r}clear(){this.verbose&&console.log("Clearing quadtree"),this.northEastCoord=new C(180,90),this.northWestCoord=new C(-180,90),this.southEastCoord=new C(180,-90),this.southWestCoord=new C(-180,-90),this.northEastChild=void 0,this.northWestChild=void 0,this.southEastChild=void 0,this.southWestChild=void 0,this.values=[]}}const Ct="3.7.7",te=Ct,T=typeof Buffer=="function",lt=typeof TextDecoder=="function"?new TextDecoder:void 0,ht=typeof TextEncoder=="function"?new TextEncoder:void 0,ee="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",R=Array.prototype.slice.call(ee),D=(o=>{let i={};return o.forEach((r,l)=>i[r]=l),i})(R),ie=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,M=String.fromCharCode.bind(String),ut=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):o=>new Uint8Array(Array.prototype.slice.call(o,0)),St=o=>o.replace(/=/g,"").replace(/[+\/]/g,i=>i=="+"?"-":"_"),bt=o=>o.replace(/[^A-Za-z0-9\+\/]/g,""),Mt=o=>{let i,r,l,h,t="";const e=o.length%3;for(let n=0;n<o.length;){if((r=o.charCodeAt(n++))>255||(l=o.charCodeAt(n++))>255||(h=o.charCodeAt(n++))>255)throw new TypeError("invalid character found");i=r<<16|l<<8|h,t+=R[i>>18&63]+R[i>>12&63]+R[i>>6&63]+R[i&63]}return e?t.slice(0,e-3)+"===".substring(e):t},ot=typeof btoa=="function"?o=>btoa(o):T?o=>Buffer.from(o,"binary").toString("base64"):Mt,K=T?o=>Buffer.from(o).toString("base64"):o=>{let r=[];for(let l=0,h=o.length;l<h;l+=4096)r.push(M.apply(null,o.subarray(l,l+4096)));return ot(r.join(""))},z=(o,i=!1)=>i?St(K(o)):K(o),ne=o=>{if(o.length<2){var i=o.charCodeAt(0);return i<128?o:i<2048?M(192|i>>>6)+M(128|i&63):M(224|i>>>12&15)+M(128|i>>>6&63)+M(128|i&63)}else{var i=65536+(o.charCodeAt(0)-55296)*1024+(o.charCodeAt(1)-56320);return M(240|i>>>18&7)+M(128|i>>>12&63)+M(128|i>>>6&63)+M(128|i&63)}},oe=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,xt=o=>o.replace(oe,ne),dt=T?o=>Buffer.from(o,"utf8").toString("base64"):ht?o=>K(ht.encode(o)):o=>ot(xt(o)),I=(o,i=!1)=>i?St(dt(o)):dt(o),ft=o=>I(o,!0),re=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,se=o=>{switch(o.length){case 4:var i=(7&o.charCodeAt(0))<<18|(63&o.charCodeAt(1))<<12|(63&o.charCodeAt(2))<<6|63&o.charCodeAt(3),r=i-65536;return M((r>>>10)+55296)+M((r&1023)+56320);case 3:return M((15&o.charCodeAt(0))<<12|(63&o.charCodeAt(1))<<6|63&o.charCodeAt(2));default:return M((31&o.charCodeAt(0))<<6|63&o.charCodeAt(1))}},wt=o=>o.replace(re,se),Pt=o=>{if(o=o.replace(/\s+/g,""),!ie.test(o))throw new TypeError("malformed base64.");o+="==".slice(2-(o.length&3));let i,r="",l,h;for(let t=0;t<o.length;)i=D[o.charAt(t++)]<<18|D[o.charAt(t++)]<<12|(l=D[o.charAt(t++)])<<6|(h=D[o.charAt(t++)]),r+=l===64?M(i>>16&255):h===64?M(i>>16&255,i>>8&255):M(i>>16&255,i>>8&255,i&255);return r},rt=typeof atob=="function"?o=>atob(bt(o)):T?o=>Buffer.from(o,"base64").toString("binary"):Pt,Et=T?o=>ut(Buffer.from(o,"base64")):o=>ut(rt(o).split("").map(i=>i.charCodeAt(0))),Ot=o=>Et(At(o)),ae=T?o=>Buffer.from(o,"base64").toString("utf8"):lt?o=>lt.decode(Et(o)):o=>wt(rt(o)),At=o=>bt(o.replace(/[-_]/g,i=>i=="-"?"+":"/")),tt=o=>ae(At(o)),le=o=>{if(typeof o!="string")return!1;const i=o.replace(/\s+/g,"").replace(/={0,2}$/,"");return!/[^\s0-9a-zA-Z\+/]/.test(i)||!/[^\s0-9a-zA-Z\-_]/.test(i)},Gt=o=>({value:o,enumerable:!1,writable:!0,configurable:!0}),kt=function(){const o=(i,r)=>Object.defineProperty(String.prototype,i,Gt(r));o("fromBase64",function(){return tt(this)}),o("toBase64",function(i){return I(this,i)}),o("toBase64URI",function(){return I(this,!0)}),o("toBase64URL",function(){return I(this,!0)}),o("toUint8Array",function(){return Ot(this)})},It=function(){const o=(i,r)=>Object.defineProperty(Uint8Array.prototype,i,Gt(r));o("toBase64",function(i){return z(this,i)}),o("toBase64URI",function(){return z(this,!0)}),o("toBase64URL",function(){return z(this,!0)})},he=()=>{kt(),It()},Bt={version:Ct,VERSION:te,atob:rt,atobPolyfill:Pt,btoa:ot,btoaPolyfill:Mt,fromBase64:tt,toBase64:I,encode:I,encodeURI:ft,encodeURL:ft,utob:xt,btou:wt,decode:tt,isValid:le,fromUint8Array:z,toUint8Array:Ot,extendString:kt,extendUint8Array:It,extendBuiltins:he},ue=10,de=50,Tt="fa-upload",fe=(o,i,r,l)=>{const{qt:h,fileLoadedCache:t,qtStorage:e}=l,n=h,s=(c,f)=>{e.save(c);const p={qt:c};f&&(p.extraLayers=f),document.dispatchEvent(new CustomEvent("mapUpdate",{detail:p}))},a=c=>c.split(".").pop(),d=async c=>{const f=zt(),p=c.target.files;if(!p.length)return;i.loadWithCurrentTotal(0,p.length);const _=new Set(Array.from(p).map(m=>a(m.name)));if(_.size>1){alert(r.t("upload.alert"));return}const y=_.values().next().value;if(y==="gpx"){let m=0;for(let g of p)if(!t.isAlreadyLoaded(g)){const w=(await f.parseGpxTrackInWorker(g)).data;for(let S of w){const b=S.lat,P=S.lon;n.locationIsOnTree(b,P,ue)||n.insertLatLng(b,P)}m+=1,m%de==0&&(i.loadWithCurrentTotal(m,p.length),s(n)),t.saveUploadedFile(g)}s(n)}else if(y==="bin"&&p.length==1){const m=new FileReader;m.onload=()=>{const g=Bt.decode(m.result),v=JSON.parse(g),w=v.qt,S=v.filesLoaded,b=v.layers;l.layers.putAll(b),l.fileLoadedCache.putAll(S);const P=O.deserialize(w);s(P,b)},m.onerror=()=>{const g=`${r.t("upload.error")} ${p[0].name}`;alert(g)},m.readAsText(p[0])}i.stop()},u=document.getElementById("gpxFileInput");u.addEventListener("change",d),L.easyButton(Tt,()=>u.click(),r.t("upload.button")).addTo(o)},Ft="fa-download",ce=o=>{const i={qt:o.qt.serialize(),filesLoaded:o.fileLoadedCache.getAll(),layers:o.layers.getAll()},l="data:text;charset=utf-8,"+Bt.encode(JSON.stringify(i)),h=document.createElement("a");h.setAttribute("href",l),h.setAttribute("download","estuve.bin"),document.body.appendChild(h),h.click(),document.body.removeChild(h)},pe=(o,i,r)=>{L.easyButton(Ft,()=>ce(i),r.t("download.button")).addTo(o)},Rt="fa-trash",_e=(o,i)=>{const r=o.fileLoadedCache,l=o.qtStorage,h=o.qt,t=o.layers,e=i.t("clear.message");confirm(e)&&(r.clear(),l.clear(),h.clear(),t.clear(),document.dispatchEvent(new CustomEvent("mapUpdate",{detail:{qt:h,removedLayerName:"ALL"}})))},me=(o,i,r)=>L.easyButton(Rt,function(l,h){_e(i,r)},r.t("clear.button")).addTo(o),Nt="fa-plus",ge=(o,i)=>{const r=document.getElementById("geojson-layer-form");r&&r.addEventListener("submit",function(l){l.preventDefault();const h=new FormData(r),t=Object.fromEntries(h.entries());i.layers.putLayer(t),o.closePopup(),document.dispatchEvent(new CustomEvent("mapUpdate",{detail:{extraLayer:t}}))})},ye=(o,i)=>{const r=`
        <form id="geojson-layer-form">
            <p>${i.t("addlayer.text1")}</p>

            <label for="new-layer-name">${i.t("addlayer.name.field")}</label>
            <input required type="text" id="new-layer-name" name="name" required placeholder="${i.t("addlayer.name.placeholder")}">

            <label for="new-layer-url">${i.t("addlayer.url.field")}</label>
            <input required type="url" id="new-layer-url" name="url" required placeholder="${i.t("addlayer.name.placeholder")}">
            <small class="help-text">
            ${i.t("addlayer.url.explanation")}
            </small>

            <label for="new-layer-color">${i.t("addlayer.color.field")}</label>
            <input required type="color" id="new-layer-color" name="color">

            <button type="submit">${i.t("addlayer.button")}</button>
        </form>
     `;L.popup({id:"add-layer-form"}).setLatLng(o.getCenter()).setContent(r).openOn(o)},Le=(o,i,r)=>(o.on("popupopen",function(l){var t;((t=l.popup.options)==null?void 0:t.id)==="add-layer-form"&&ge(l.target,i)}),L.easyButton(Nt,function(l,h){ye(h,r)},r.t("addlayer.button")).addTo(o)),Ut="fa-layer-group",ve=o=>{document.querySelectorAll(".remove-layer-btn").forEach(i=>{i.addEventListener("click",r=>{const l=i.getAttribute("data-layer-name");o.layers.removeLayer(l),r.target.closest("li").remove(),document.dispatchEvent(new CustomEvent("mapUpdate",{detail:{removedLayerName:l}}))})})},Ce=(o,i,r)=>{const l=`
    <section id="existing-layers-section">
      <p>${r.t("layer.text")}</p>
      <ul id="existing-layers-list">
        ${i.layers.getAll().map(h=>`
              <li>
                <span>${h.name}</span>
                <button data-layer-name="${h.name}" class="remove-layer-btn" title="Remove layer">
                  <i class="fas fa-trash-alt"></i>
                </button>
              </li>
            `).join("")}
      </ul>
    </section>
  `;L.popup({id:"layer-form"}).setLatLng(o.getCenter()).setContent(l).openOn(o)},Se=(o,i,r)=>(o.on("popupopen",function(l){var t;((t=l.popup.options)==null?void 0:t.id)==="layer-form"&&ve(i)}),L.easyButton(Ut,function(l,h){Ce(h,i,r)},r.t("layer.button")).addTo(o)),be=(o,i)=>{const r=`
     <b><span id="info-title">${i.t("info.title")}</span></b>
     <br>
     <span id="info-content">${i.t("info.content")}</span>
     <p>
          <span><i class="fa ${Tt}"></i><b>&nbsp;${i.t("upload.button")}</b></span><br/>
          <span>${i.t("upload.help")}</span>
     </p>
     <p><span><i class="fa ${Ft}"></i><b>&nbsp;${i.t("download.button")}</b></span><br/>
          <span>${i.t("download.help")}</span>
     </p>
     <p><span><i class="fa ${Rt}"></i><b>&nbsp;${i.t("clear.button")}</b><br/>
          <span>${i.t("clear.help")}</span>
     </p>
     <p><span><i class="fa ${Nt}"></i><b>&nbsp;${i.t("addlayer.button")}</b><br/>
          <span>${i.t("addlayer.help")}</span>
     </p>
          <p><span><i class="fa ${Ut}"></i><b>&nbsp;${i.t("layer.button")}</b><br/>
          <span>${i.t("layer.help")}</span>
     </p>
     `;L.popup().setLatLng(o.getCenter()).setContent(r).openOn(o)},Me=(o,i)=>{L.easyButton("fa-info-circle",function(r,l){be(l,i)},i.t("info.button")).addTo(o)};function et(o,i,r,l){let h=l;const t=i+(r-i>>1);let e=r-i,n;const s=o[i],a=o[i+1],d=o[r],u=o[r+1];for(let c=i+3;c<r;c+=3){const f=xe(o[c],o[c+1],s,a,d,u);if(f>h)n=c,h=f;else if(f===h){const p=Math.abs(c-t);p<e&&(n=c,e=p)}}h>l&&(n-i>3&&et(o,i,n,l),o[n+2]=h,r-n>3&&et(o,n,r,l))}function xe(o,i,r,l,h,t){let e=h-r,n=t-l;if(e!==0||n!==0){const s=((o-r)*e+(i-l)*n)/(e*e+n*n);s>1?(r=h,l=t):s>0&&(r+=e*s,l+=n*s)}return e=o-r,n=i-l,e*e+n*n}function Z(o,i,r,l){const h={id:o??null,type:i,geometry:r,tags:l,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(i==="Point"||i==="MultiPoint"||i==="LineString")j(h,r);else if(i==="Polygon")j(h,r[0]);else if(i==="MultiLineString")for(const t of r)j(h,t);else if(i==="MultiPolygon")for(const t of r)j(h,t[0]);return h}function j(o,i){for(let r=0;r<i.length;r+=3)o.minX=Math.min(o.minX,i[r]),o.minY=Math.min(o.minY,i[r+1]),o.maxX=Math.max(o.maxX,i[r]),o.maxY=Math.max(o.maxY,i[r+1])}function we(o,i){const r=[];if(o.type==="FeatureCollection")for(let l=0;l<o.features.length;l++)q(r,o.features[l],i,l);else o.type==="Feature"?q(r,o,i):q(r,{geometry:o},i);return r}function q(o,i,r,l){if(!i.geometry)return;const h=i.geometry.coordinates;if(h&&h.length===0)return;const t=i.geometry.type,e=Math.pow(r.tolerance/((1<<r.maxZoom)*r.extent),2);let n=[],s=i.id;if(r.promoteId?s=i.properties[r.promoteId]:r.generateId&&(s=l||0),t==="Point")ct(h,n);else if(t==="MultiPoint")for(const a of h)ct(a,n);else if(t==="LineString")it(h,n,e,!1);else if(t==="MultiLineString")if(r.lineMetrics){for(const a of h)n=[],it(a,n,e,!1),o.push(Z(s,"LineString",n,i.properties));return}else J(h,n,e,!1);else if(t==="Polygon")J(h,n,e,!0);else if(t==="MultiPolygon")for(const a of h){const d=[];J(a,d,e,!0),n.push(d)}else if(t==="GeometryCollection"){for(const a of i.geometry.geometries)q(o,{id:s,geometry:a,properties:i.properties},r,l);return}else throw new Error("Input data is not a valid GeoJSON object.");o.push(Z(s,t,n,i.properties))}function ct(o,i){i.push(Zt(o[0]),Wt(o[1]),0)}function it(o,i,r,l){let h,t,e=0;for(let s=0;s<o.length;s++){const a=Zt(o[s][0]),d=Wt(o[s][1]);i.push(a,d,0),s>0&&(l?e+=(h*d-a*t)/2:e+=Math.sqrt(Math.pow(a-h,2)+Math.pow(d-t,2))),h=a,t=d}const n=i.length-3;i[2]=1,et(i,0,n,r),i[n+2]=1,i.size=Math.abs(e),i.start=0,i.end=i.size}function J(o,i,r,l){for(let h=0;h<o.length;h++){const t=[];it(o[h],t,r,l),i.push(t)}}function Zt(o){return o/360+.5}function Wt(o){const i=Math.sin(o*Math.PI/180),r=.5-.25*Math.log((1+i)/(1-i))/Math.PI;return r<0?0:r>1?1:r}function A(o,i,r,l,h,t,e,n){if(r/=i,l/=i,t>=r&&e<l)return o;if(e<r||t>=l)return null;const s=[];for(const a of o){const d=a.geometry;let u=a.type;const c=h===0?a.minX:a.minY,f=h===0?a.maxX:a.maxY;if(c>=r&&f<l){s.push(a);continue}else if(f<r||c>=l)continue;let p=[];if(u==="Point"||u==="MultiPoint")Pe(d,p,r,l,h);else if(u==="LineString")Dt(d,p,r,l,h,!1,n.lineMetrics);else if(u==="MultiLineString")V(d,p,r,l,h,!1);else if(u==="Polygon")V(d,p,r,l,h,!0);else if(u==="MultiPolygon")for(const _ of d){const y=[];V(_,y,r,l,h,!0),y.length&&p.push(y)}if(p.length){if(n.lineMetrics&&u==="LineString"){for(const _ of p)s.push(Z(a.id,u,_,a.tags));continue}(u==="LineString"||u==="MultiLineString")&&(p.length===1?(u="LineString",p=p[0]):u="MultiLineString"),(u==="Point"||u==="MultiPoint")&&(u=p.length===3?"Point":"MultiPoint"),s.push(Z(a.id,u,p,a.tags))}}return s.length?s:null}function Pe(o,i,r,l,h){for(let t=0;t<o.length;t+=3){const e=o[t+h];e>=r&&e<=l&&B(i,o[t],o[t+1],o[t+2])}}function Dt(o,i,r,l,h,t,e){let n=pt(o);const s=h===0?Ee:Oe;let a=o.start,d,u;for(let m=0;m<o.length-3;m+=3){const g=o[m],v=o[m+1],w=o[m+2],S=o[m+3],b=o[m+4],P=h===0?g:v,E=h===0?S:b;let H=!1;e&&(d=Math.sqrt(Math.pow(g-S,2)+Math.pow(v-b,2))),P<r?E>r&&(u=s(n,g,v,S,b,r),e&&(n.start=a+d*u)):P>l?E<l&&(u=s(n,g,v,S,b,l),e&&(n.start=a+d*u)):B(n,g,v,w),E<r&&P>=r&&(u=s(n,g,v,S,b,r),H=!0),E>l&&P<=l&&(u=s(n,g,v,S,b,l),H=!0),!t&&H&&(e&&(n.end=a+d*u),i.push(n),n=pt(o)),e&&(a+=d)}let c=o.length-3;const f=o[c],p=o[c+1],_=o[c+2],y=h===0?f:p;y>=r&&y<=l&&B(n,f,p,_),c=n.length-3,t&&c>=3&&(n[c]!==n[0]||n[c+1]!==n[1])&&B(n,n[0],n[1],n[2]),n.length&&i.push(n)}function pt(o){const i=[];return i.size=o.size,i.start=o.start,i.end=o.end,i}function V(o,i,r,l,h,t){for(const e of o)Dt(e,i,r,l,h,t,!1)}function B(o,i,r,l){o.push(i,r,l)}function Ee(o,i,r,l,h,t){const e=(t-i)/(l-i);return B(o,t,r+(h-r)*e,1),e}function Oe(o,i,r,l,h,t){const e=(t-r)/(h-r);return B(o,i+(l-i)*e,t,1),e}function Ae(o,i){const r=i.buffer/i.extent;let l=o;const h=A(o,1,-1-r,r,0,-1,2,i),t=A(o,1,1-r,2+r,0,-1,2,i);return(h||t)&&(l=A(o,1,-r,1+r,0,-1,2,i)||[],h&&(l=_t(h,1).concat(l)),t&&(l=l.concat(_t(t,-1)))),l}function _t(o,i){const r=[];for(let l=0;l<o.length;l++){const h=o[l],t=h.type;let e;if(t==="Point"||t==="MultiPoint"||t==="LineString")e=Y(h.geometry,i);else if(t==="MultiLineString"||t==="Polygon"){e=[];for(const n of h.geometry)e.push(Y(n,i))}else if(t==="MultiPolygon"){e=[];for(const n of h.geometry){const s=[];for(const a of n)s.push(Y(a,i));e.push(s)}}r.push(Z(h.id,t,e,h.tags))}return r}function Y(o,i){const r=[];r.size=o.size,o.start!==void 0&&(r.start=o.start,r.end=o.end);for(let l=0;l<o.length;l+=3)r.push(o[l]+i,o[l+1],o[l+2]);return r}function mt(o,i){if(o.transformed)return o;const r=1<<o.z,l=o.x,h=o.y;for(const t of o.features){const e=t.geometry,n=t.type;if(t.geometry=[],n===1)for(let s=0;s<e.length;s+=2)t.geometry.push(gt(e[s],e[s+1],i,r,l,h));else for(let s=0;s<e.length;s++){const a=[];for(let d=0;d<e[s].length;d+=2)a.push(gt(e[s][d],e[s][d+1],i,r,l,h));t.geometry.push(a)}}return o.transformed=!0,o}function gt(o,i,r,l,h,t){return[Math.round(r*(o*l-h)),Math.round(r*(i*l-t))]}function Ge(o,i,r,l,h){const t=i===h.maxZoom?0:h.tolerance/((1<<i)*h.extent),e={features:[],numPoints:0,numSimplified:0,numFeatures:o.length,source:null,x:r,y:l,z:i,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const n of o)ke(e,n,t,h);return e}function ke(o,i,r,l){const h=i.geometry,t=i.type,e=[];if(o.minX=Math.min(o.minX,i.minX),o.minY=Math.min(o.minY,i.minY),o.maxX=Math.max(o.maxX,i.maxX),o.maxY=Math.max(o.maxY,i.maxY),t==="Point"||t==="MultiPoint")for(let n=0;n<h.length;n+=3)e.push(h[n],h[n+1]),o.numPoints++,o.numSimplified++;else if(t==="LineString")X(e,h,o,r,!1,!1);else if(t==="MultiLineString"||t==="Polygon")for(let n=0;n<h.length;n++)X(e,h[n],o,r,t==="Polygon",n===0);else if(t==="MultiPolygon")for(let n=0;n<h.length;n++){const s=h[n];for(let a=0;a<s.length;a++)X(e,s[a],o,r,!0,a===0)}if(e.length){let n=i.tags||null;if(t==="LineString"&&l.lineMetrics){n={};for(const a in i.tags)n[a]=i.tags[a];n.mapbox_clip_start=h.start/h.size,n.mapbox_clip_end=h.end/h.size}const s={geometry:e,type:t==="Polygon"||t==="MultiPolygon"?3:t==="LineString"||t==="MultiLineString"?2:1,tags:n};i.id!==null&&(s.id=i.id),o.features.push(s)}}function X(o,i,r,l,h,t){const e=l*l;if(l>0&&i.size<(h?e:l)){r.numPoints+=i.length/3;return}const n=[];for(let s=0;s<i.length;s+=3)(l===0||i[s+2]>e)&&(r.numSimplified++,n.push(i[s],i[s+1])),r.numPoints++;h&&Ie(n,t),o.push(n)}function Ie(o,i){let r=0;for(let l=0,h=o.length,t=h-2;l<h;t=l,l+=2)r+=(o[l]-o[t])*(o[l+1]+o[t+1]);if(r>0===i)for(let l=0,h=o.length;l<h/2;l+=2){const t=o[l],e=o[l+1];o[l]=o[h-2-l],o[l+1]=o[h-1-l],o[h-2-l]=t,o[h-1-l]=e}}const Be={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Te{constructor(i,r){r=this.options=Fe(Object.create(Be),r);const l=r.debug;if(l&&console.time("preprocess data"),r.maxZoom<0||r.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(r.promoteId&&r.generateId)throw new Error("promoteId and generateId cannot be used together.");let h=we(i,r);this.tiles={},this.tileCoords=[],l&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",r.indexMaxZoom,r.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),h=Ae(h,r),h.length&&this.splitTile(h,0,0,0),l&&(h.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(i,r,l,h,t,e,n){const s=[i,r,l,h],a=this.options,d=a.debug;for(;s.length;){h=s.pop(),l=s.pop(),r=s.pop(),i=s.pop();const u=1<<r,c=Q(r,l,h);let f=this.tiles[c];if(!f&&(d>1&&console.time("creation"),f=this.tiles[c]=Ge(i,r,l,h,a),this.tileCoords.push({z:r,x:l,y:h}),d)){d>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",r,l,h,f.numFeatures,f.numPoints,f.numSimplified),console.timeEnd("creation"));const E=`z${r}`;this.stats[E]=(this.stats[E]||0)+1,this.total++}if(f.source=i,t==null){if(r===a.indexMaxZoom||f.numPoints<=a.indexMaxPoints)continue}else{if(r===a.maxZoom||r===t)continue;if(t!=null){const E=t-r;if(l!==e>>E||h!==n>>E)continue}}if(f.source=null,i.length===0)continue;d>1&&console.time("clipping");const p=.5*a.buffer/a.extent,_=.5-p,y=.5+p,m=1+p;let g=null,v=null,w=null,S=null,b=A(i,u,l-p,l+y,0,f.minX,f.maxX,a),P=A(i,u,l+_,l+m,0,f.minX,f.maxX,a);i=null,b&&(g=A(b,u,h-p,h+y,1,f.minY,f.maxY,a),v=A(b,u,h+_,h+m,1,f.minY,f.maxY,a),b=null),P&&(w=A(P,u,h-p,h+y,1,f.minY,f.maxY,a),S=A(P,u,h+_,h+m,1,f.minY,f.maxY,a),P=null),d>1&&console.timeEnd("clipping"),s.push(g||[],r+1,l*2,h*2),s.push(v||[],r+1,l*2,h*2+1),s.push(w||[],r+1,l*2+1,h*2),s.push(S||[],r+1,l*2+1,h*2+1)}}getTile(i,r,l){i=+i,r=+r,l=+l;const h=this.options,{extent:t,debug:e}=h;if(i<0||i>24)return null;const n=1<<i;r=r+n&n-1;const s=Q(i,r,l);if(this.tiles[s])return mt(this.tiles[s],t);e>1&&console.log("drilling down to z%d-%d-%d",i,r,l);let a=i,d=r,u=l,c;for(;!c&&a>0;)a--,d=d>>1,u=u>>1,c=this.tiles[Q(a,d,u)];return!c||!c.source?null:(e>1&&(console.log("found parent tile z%d-%d-%d",a,d,u),console.time("drilling down")),this.splitTile(c.source,a,d,u,i,r,l),e>1&&console.timeEnd("drilling down"),this.tiles[s]?mt(this.tiles[s],t):null)}}function Q(o,i,r){return((1<<o)*r+i)*32+o}function Fe(o,i){for(const r in i)o[r]=i[r];return o}function Re(o,i){return new Te(o,i)}L.GeoJSON.VT=L.GridLayer.extend({options:{async:!1},initialize:function(o,i){L.setOptions(this,i),L.GridLayer.prototype.initialize.call(this,i),this.tileIndex=geojsonvt(o,this.options)},createTile:function(o){var i=L.DomUtil.create("canvas","leaflet-tile"),r=this.getTileSize();i.width=r.x,i.height=r.y;for(var l=i.getContext("2d"),h=this.tileIndex.getTile(o.z,o.x,o.y),t=h?h.features:[],e=0;e<t.length;e++){var n=t[e];this.drawFeature(l,n)}return i},drawFeature:function(o,i){i.type;var r=i.type;if(o.beginPath(),this.options.style&&(this.options.style instanceof Function?this.setStyle(o,this.options.style(i.tags)):this.setStyle(o,this.options.style)),r===2||r===3)for(var l=0;l<i.geometry.length;l++)for(var h=i.geometry[l],t=0;t<h.length;t++){var e=h[t];t?o.lineTo(e[0]/16,e[1]/16):o.moveTo(e[0]/16,e[1]/16)}else if(r===1)for(var l=0;l<i.geometry.length;l++){var e=i.geometry[l];o.arc(e[0]/16,e[1]/16,2,0,Math.PI*2,!0)}r===3&&o.fill(this.options.style.fillRule||"evenodd"),o.stroke()},setStyle:function(o,i){i.stroke;{o.lineWidth=i.weight||5;var r=this.setOpacity(i.color,i.opacity);o.strokeStyle=r}i.fill;{o.fillStyle=i.fillColor||"#03f";var r=this.setOpacity(i.fillColor,i.fillOpacity);o.fillStyle=r}},setOpacity:function(o,i){if(i){var o=o||"#03f";if(o.iscolorHex()){var r=o.colorRgb();return"rgba("+r[0]+","+r[1]+","+r[2]+","+i+")"}else return o}else return o}});L.geoJson.vt=function(o,i){return new L.GeoJSON.VT(o,i)};String.prototype.iscolorHex=function(){var o=this.toLowerCase(),i=/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/;return i.test(o)};String.prototype.colorRgb=function(){var o=this.toLowerCase();if(o.length===4){for(var i="#",r=1;r<4;r+=1)i+=o.slice(r,r+1).concat(o.slice(r,r+1));o=i}for(var l=[],r=1;r<7;r+=2)l.push(parseInt("0x"+o.slice(r,r+2)));return l};window.geojsonvt=Re;const Ne=()=>{const o=l=>({type:"Feature",geometry:{type:"Point",coordinates:[l[1],l[0]]}}),i=l=>({type:"FeatureCollection",features:l.map(h=>o(h))}),r={name:"tracks",maxZoom:20,tolerance:3,debug:0,style:{color:"#3388FF",weight:2,fillOpacity:.2},zIndex:2};return{setFromQuadTree(l){const h=i(l.points());return L.geoJson.vt(h,r)},async setFromExtralayer(l){return fetch(l.url).then(h=>h.json()).then(h=>L.geoJson.vt(h,{name:l.name,style:function(t){return{color:t.flag?l.color:"#FF00FF",weight:10,opacity:1}}}))}}},Ue={onAdd:function(){return L.DomUtil.create("progress","loader")},loadWithCurrentTotal:(o,i)=>{const r=document.getElementsByClassName("loader")[0];r.min=0,r.max=i,r.value=o,r.style.display="block"},load:()=>{const o=document.getElementsByClassName("loader")[0];o.style.display="block"},stop:()=>{document.getElementsByClassName("loader")[0].style.display="none"}},Ze=o=>{L.Control.ProgressBar=L.Control.extend(Ue);const i=new L.Control.ProgressBar({position:"bottomleft"});return i.addTo(o),i.stop(),i},We=()=>{const o="uploadedFiles";return{isAlreadyLoaded(i){return(JSON.parse(localStorage.getItem(o))||[]).includes(i.name)},saveUploadedFile(i){if(!this.isAlreadyLoaded(i)){const l=[...JSON.parse(localStorage.getItem(o))||[],i.name];localStorage.setItem(o,JSON.stringify(l))}},clear(){localStorage.removeItem(o)},getAll(){return JSON.parse(localStorage.getItem(o))||[]},putAll(i){localStorage.setItem(o,JSON.stringify(i))}}},De=()=>{const o="geodb",i="geoData",r="estuve-quadtree";return{openDatabase(){return new Promise((l,h)=>{const t=indexedDB.open(o,1);t.onupgradeneeded=function(e){const n=e.target.result;n.objectStoreNames.contains(i)||n.createObjectStore(i,{keyPath:"id"})},t.onsuccess=function(e){l(e.target.result)},t.onerror=function(e){h(e.target.error)}})},async save(l){const t=(await this.openDatabase()).transaction(i,"readwrite");return t.objectStore(i).put({id:r,data:l}),new Promise((n,s)=>{t.oncomplete=()=>n(),t.onerror=()=>s(t.error)})},async load(){const e=(await this.openDatabase()).transaction(i,"readonly").objectStore(i).get(r);return new Promise((n,s)=>{e.onsuccess=()=>{var a;if(e.result&&((a=e.result)!=null&&a.data)){n(O.fromObject(e.result.data));return}n(O.empty())},e.onerror=()=>s(e.error)})},async clear(){const h=(await this.openDatabase()).transaction(i,"readwrite");return h.objectStore(i).delete(r),new Promise((e,n)=>{h.oncomplete=()=>e(),h.onerror=()=>n(h.error)})}}},je=()=>{const o="layers";return{putLayer(i){const l=[...JSON.parse(localStorage.getItem(o))||[],i];localStorage.setItem(o,JSON.stringify(l))},removeLayer(i){const l=(JSON.parse(localStorage.getItem(o))||[]).filter(h=>h.name!==i);localStorage.setItem(o,JSON.stringify(l))},getAll(){return JSON.parse(localStorage.getItem(o))||[]},putAll(i){localStorage.setItem(o,JSON.stringify(i))},clear(){localStorage.removeItem(o)}}},x=vt.map("map").setView([41.53289317099601,2.104000992549118],4),yt=je(),U=Ne(),W=qt(x);let k=null,N={};const $e=Ze(x),ze=We(),Lt=De(),jt=o=>{k&&(x.removeLayer(k),W.removeLayer(k)),o.addTo(x),k=o,window.geoJsonLayer=k,W.addOverlay(k,"Tracks")},nt=o=>{W.addOverlay(o,o.options.name),N[o.options.name]=o},qe=o=>{if(o==="ALL"){const r=Object.values(N);for(let l of r)W.removeLayer(l),x.removeLayer(l);N={};return}const i=N[o];W.removeLayer(i),x.removeLayer(i),delete N[o]};document.addEventListener("mapUpdate",o=>{if(o.detail.qt){let i=U.setFromQuadTree(o.detail.qt);jt(i)}if(o.detail.extraLayer&&U.setFromExtralayer(o.detail.extraLayer).then(i=>{nt(i)}),o.detail.extraLayers)for(let i of o.detail.extraLayers)U.setFromExtralayer(i).then(r=>{nt(r)});o.detail.removedLayerName&&qe(o.detail.removedLayerName)});Promise.all([Ht,Lt.load()]).then(([o,i])=>{const r={qt:i,fileLoadedCache:ze,qtStorage:Lt,layers:yt};Me(x,G),fe(x,$e,G,r),pe(x,r,G),me(x,r,G),Le(x,r,G),Se(x,r,G);const l=U.setFromQuadTree(i);jt(l);for(let h of yt.getAll())U.setFromExtralayer(h).then(t=>{nt(t)})}).catch(o=>{console.error("Error loading dependencies:",o)});navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(o){const i=new vt.LatLng(o.coords.latitude,o.coords.longitude);x.panTo(i)});const He=new Jt({provider:new Vt,style:"bar",showMarker:!1});x.addControl(He);window.i18next=G;window.map=x;
